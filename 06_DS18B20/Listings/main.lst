C51 COMPILER V9.57.0.0   MAIN                                                              12/01/2019 22:41:23 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\MDK\install\Core\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          sbit HC138_A = P2^5;
   6          sbit HC138_B = P2^6;
   7          sbit HC138_C = P2^7;
   8          sbit DB = P1^4;
   9          uchar TPH = 0;
  10          uchar TPL = 0;
  11          uint temp = 0;
  12          
  13          uchar code tab[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  14          uchar code select[] = {0x01,0x02,0x04,0x08};
  15          
  16          void Delay500us()               //@11.0592MHz
  17          {
  18   1              unsigned char i, j;
  19   1              _nop_();
  20   1              _nop_();
  21   1              i = 6;
  22   1              j = 93;
  23   1              do
  24   1              {
  25   2                      while (--j);
  26   2              } while (--i);
  27   1      }
  28          
  29          void Delay2us()         //@11.0592MHz
  30          {
  31   1              unsigned char i;
  32   1      
  33   1              i = 3;
  34   1              while (--i);
  35   1      }
  36          
  37          void Delay600us()               //@11.0592MHz
  38          {
  39   1              unsigned char i, j;
  40   1              i = 7;
  41   1              j = 113;
  42   1              do
  43   1              {
  44   2                      while (--j);
  45   2              } while (--i);
  46   1      }
  47          
  48          void Delay10us()                //@11.0592MHz
  49          {
  50   1              unsigned char i;
  51   1      
  52   1              _nop_();
  53   1              i = 25;
  54   1              while (--i);
C51 COMPILER V9.57.0.0   MAIN                                                              12/01/2019 22:41:23 PAGE 2   

  55   1      }
  56          
  57          void Delay420us()               //@11.0592MHz
  58          {
  59   1              unsigned char i, j;
  60   1      
  61   1              _nop_();
  62   1              i = 5;
  63   1              j = 129;
  64   1              do
  65   1              {
  66   2                      while (--j);
  67   2              } while (--i);
  68   1      }
  69          
  70          void Delay60us()                //@11.0592MHz
  71          {
  72   1              unsigned char i, j;
  73   1      
  74   1              i = 1;
  75   1              j = 162;
  76   1              do
  77   1              {
  78   2                      while (--j);
  79   2              } while (--i);
  80   1      }
  81          
  82          
  83          void Delay480us()               //@11.0592MHz
  84          {
  85   1              unsigned char i, j;
  86   1      
  87   1              i = 6;
  88   1              j = 38;
  89   1              do
  90   1              {
  91   2                      while (--j);
  92   2              } while (--i);
  93   1      }
  94          
  95          void Delay50us()                //@11.0592MHz
  96          {
  97   1              unsigned char i, j;
  98   1              _nop_();
  99   1              i = 1;
 100   1              j = 134;
 101   1              do
 102   1              {
 103   2                      while (--j);
 104   2              } while (--i);
 105   1      }
 106          
 107          //void Delay390us()             //@11.0592MHz
 108          //{
 109          //      unsigned char i, j;
 110          //      _nop_();
 111          //      i = 5;
 112          //      j = 46;
 113          //      do
 114          //      {
 115          //              while (--j);
 116          //      } while (--i);
C51 COMPILER V9.57.0.0   MAIN                                                              12/01/2019 22:41:23 PAGE 3   

 117          //}
 118          
 119          
 120          void System_Init()
 121          {
 122   1              HC138_A = 1;
 123   1              HC138_B = 0;
 124   1              HC138_C = 1;
 125   1              WR = 0;
 126   1              P0 = 0x00;
 127   1              HC138_A = 0;
 128   1              HC138_B = 0;
 129   1              HC138_C = 1;
 130   1              WR = 0;
 131   1              P0 = 0xFF;
 132   1      }
 133          
 134          void LED_Display(uchar selection, uchar segment)
 135          {
 136   1              HC138_A = 0;
 137   1              HC138_B = 1;
 138   1              HC138_C = 1;
 139   1              WR = 0;
 140   1              P0 = 0x00;
 141   1              HC138_A = 1;
 142   1              HC138_B = 1;
 143   1              HC138_C = 1;
 144   1              WR = 0;
 145   1              P0 = tab[segment];
 146   1              HC138_A = 0;
 147   1              HC138_B = 1;
 148   1              HC138_C = 1;
 149   1              WR = 0;
 150   1              P0 = select[selection];
 151   1              Delay600us();
 152   1              HC138_A = 1;
 153   1              HC138_B = 1;
 154   1              HC138_C = 1;
 155   1              WR = 0;
 156   1              P0 = 0xFF;
 157   1              HC138_A = 0;
 158   1              HC138_B = 1;
 159   1              HC138_C = 1;
 160   1              WR = 0;
 161   1              P0 = 0x00;
 162   1      }
 163                  
 164          void DS18B20_Init()
 165          {
 166   1              CY = 1;
 167   1              while(CY)
 168   1              {
 169   2                      DB = 0;
 170   2                      Delay480us();
 171   2                      DB = 1;
 172   2                      Delay60us();
 173   2                      CY = DB;
 174   2                      Delay420us();
 175   2              }
 176   1      }
 177          
 178          void DS18B20_Write_Byte(uchar byte_data)
C51 COMPILER V9.57.0.0   MAIN                                                              12/01/2019 22:41:23 PAGE 4   

 179          {
 180   1              uchar i;
 181   1              for(i=0; i<8; i++)
 182   1              {
 183   2                      DB = 0;
 184   2                      Delay10us();
 185   2                      DB = byte_data & 0x01;          // 0000000x
 186   2                      Delay60us();
 187   2                      DB = 1;
 188   2                      Delay10us();
 189   2                      byte_data >>= 1;
 190   2              }
 191   1      }
 192          
 193          uchar DS18B20_Read_Byte()
 194          {
 195   1              uchar i;
 196   1              uchar byte_data = 0;
 197   1              for(i=0; i<8; i++)
 198   1              {
 199   2                      byte_data >>= 1;
 200   2                      DB = 0;
 201   2                      Delay2us();
 202   2                      DB = 1;
 203   2                      Delay10us();
 204   2                      if(DB)
 205   2                      byte_data |= 0x80;
 206   2                      Delay50us();
 207   2              }
 208   1              return byte_data;
 209   1      }
 210          
 211          void DS18B20_FUNCTION()
 212          {
 213   1              DS18B20_Init();
 214   1              DS18B20_Write_Byte(0xCC);       // Skip ROM
 215   1              DS18B20_Write_Byte(0x44);       // Convert T
 216   1              while(!DB);
 217   1              DS18B20_Init();
 218   1              DS18B20_Write_Byte(0xCC);       // Skip ROM
 219   1              DS18B20_Write_Byte(0xBE);       // Read Scratchpad
 220   1              TPL = DS18B20_Read_Byte();
 221   1              TPH = DS18B20_Read_Byte();
 222   1              temp = ((TPH << 8) + TPL) * 6.25;
 223   1      }
 224          
 225          void main()
 226          {
 227   1              System_Init();
 228   1              while(1)
 229   1              {
 230   2                      DS18B20_FUNCTION();
 231   2                      Delay500us();
 232   2                      {
 233   3                              LED_Display(0, temp/1000);
 234   3                              LED_Display(1, (temp/100)%10);
 235   3                              LED_Display(2, (temp%100)/10);
 236   3                              LED_Display(3, temp%10);
 237   3                      }
 238   2              }
 239   1      }

C51 COMPILER V9.57.0.0   MAIN                                                              12/01/2019 22:41:23 PAGE 5   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    416    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
